### web性能优化

https://mp.weixin.qq.com/s/tSeD4oxqyOsObYl2LUFGFg

## Web Worker

>Web Worker 是HTML5提供的一个Javascript多线程解决方案，运行在浏览器后台。

```
1.它是一种JavaScript 工作线程，不能直接访问DOM

2.能发送网络请求

3.它在不用时会被中止，并在下次有需要时重启

4.在开发过程中，可以通过 localhost 使用服务工作线程，但如果要在网站上部署服务工作线程，
需要在服务器上设置 HTTPS

5.Worker 线程无法读取本地文件,它所加载的脚本，必须来自网络，这样做主要是为了安全,
所以只能访问*同源的网络文件*,所以本地调试的时候需要开启服务，用node或者后台语言启动
```

例:

```
var worker = new Worker("worker.js");
console.log(new Date().getTime()) // 开始时间
worker.postMessage("123456")
worker.onmessage = function (e) {
    console.log(new Date().getTime()) // 接收时间
}


// worker.js
onmessage =function (evt){
  var d = evt.data  //通过evt.data获得发送来的数据
  postMessage( d )  //将获取到的数据发送会主线程
}
```

**总结**:一些高计算耗费时间的功能，可以放到web worker中计算完成后再返回回来。

## SPA项目首页白屏问题

>采用SPA模式，就意味着，首页或者main.js过大，首屏加载的速度会受到很大的限制。会存在一定时间的白屏。

>SPA项目因为html都是js去生成的（虚拟Dom原理），所以在js没有执行加载完之前，dom是不会有的。
一开始客户端从服务端获取到html只是一个空壳，所以会显示白屏。

1. 服务端渲染SSR（加快首屏加载和SEO）

2. 预渲染

```
预渲染是一个方案，使用爬虫技术。由于我们打包过后的都是一些js文件，
使用一些技术（puppeteer）可以爬取到项目在chrome浏览器展示的页面，
然后把它写入js,和打包文件一起。类似prerender-spa-plugin

不过这种技术的缺点也很明显，我们在打包过程中，所展示的页面是当时环境下的数据，
也就是说如果首页有很多的动态获取的数据（比如说实时的股票价格），那如果采用这种方案，
用户第一眼看到并不是当时数据，会认为是个错误信息。
```

3.骨架屏(占位块和图片)

```
1.通过编译的时候自动生成:
puppeteer(它主要是能在代码里面唤起chrome浏览器，或者后台唤起，也就是没有弹出浏览器，
但是可以获取到真实浏览器中渲染的内容),有了它我们就能获取到浏览器里面的dom元素，
然后通过对页面中元素进行删减或增添，对已有元素进行修改生成我们想要的骨架，然后将修改后的 HTML 
和 CSS 样式提取出来

2.通过设计图+布局:
这是一种直接重新写一个页面的方式，图片的话采用svg和base64的形式，生成一个dom,
解析注入到服务器返回的index.html里面（ssr render注入）。
```

## SSL延迟

>HTTP耗时 = TCP握手 ; HTTPS耗时 = TCP握手 + SSL握手

```
ssl耗时是tcp的三倍左右，具体数字取决于CPU的快慢和网络状况。
如果是对安全性要求不高的场合，为了提高网页性能，建议不要采用保密强度很高的数字证书。
```

## 防抖节流

>防抖（当持续触发事件时，一定时间段内没有再触发事件，事件处理函数才会执行一次）

```
防抖我们可以理解为，存在一个scroll事件，只要滚动就会触发handler回调函数，防抖的处理是，
等scroll事件完全停下来1000ms（这个值自行设定）之后，再出触发handler函数。
```

>节流（当持续触发事件时，保证一定时间段内只调用一次事件处理函数）

```
节流顾名思义，触发scroll事件的时候，并不立即执行handle函数，
每隔1000ms（这个值自行设定）才会执行一次handle函数
```

## 重排与重绘

>网页的生成过程

```
HTML代码转化成DOM

CSS代码转化成CSSOM（CSS Object Model）

结合DOM和CSSOM，生成一棵渲染树（包含每个节点的视觉信息）

生成布局（layout），即将所有渲染树的所有节点进行平面合成

将布局绘制（paint）在屏幕上
```

>会导致浏览器重新渲染

```
1.修改DOM

2.修改样式表

3.用户事件（比如鼠标悬停、页面滚动、输入框键入文字、改变窗口大小等等）
```

**重新渲染，就需要重新生成布局和重新绘制。前者叫做"重排"（reflow），后者叫做"重绘"(repaint)**

```
重排和重绘不断的触发，是影响网页性能低下的根本原因。提高网页性能，
就是要降低"重排"和"重绘"的频率和成本，尽量少触发重新渲染。重排必定会重绘，
而重绘不一定重排。
```















